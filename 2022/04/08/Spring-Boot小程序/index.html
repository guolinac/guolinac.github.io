<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/haon2.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/haon2.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"guolinac.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="环境准备软件版本：java1.8，maven3.5.0，mysql5.7.25  安装maven3.5.0  Maven系列教材 （二）- 下载与配置Maven (how2j.cn)">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot红包小程序">
<meta property="og:url" content="https://guolinac.github.io/2022/04/08/Spring-Boot%E5%B0%8F%E7%A8%8B%E5%BA%8F/index.html">
<meta property="og:site_name" content="郭霖的博客">
<meta property="og:description" content="环境准备软件版本：java1.8，maven3.5.0，mysql5.7.25  安装maven3.5.0  Maven系列教材 （二）- 下载与配置Maven (how2j.cn)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105029040.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105105212.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105304989.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105336611.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105859291.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819111323585.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819111525689.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819140112581.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819150559273.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155417931.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155424289.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155557638.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819161137300.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819172623634.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155557638.png">
<meta property="og:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220821184121229.png">
<meta property="article:published_time" content="2022-04-08T06:35:47.000Z">
<meta property="article:modified_time" content="2022-08-21T11:58:32.802Z">
<meta property="article:author" content="郭霖">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="红包程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105029040.png">

<link rel="canonical" href="https://guolinac.github.io/2022/04/08/Spring-Boot%E5%B0%8F%E7%A8%8B%E5%BA%8F/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring Boot红包小程序 | 郭霖的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">郭霖的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">好好学习，天天向上！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">13</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">13</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://guolinac.github.io/2022/04/08/Spring-Boot%E5%B0%8F%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/haon1.jpg">
      <meta itemprop="name" content="郭霖">
      <meta itemprop="description" content="编程使我快乐">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭霖的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Boot红包小程序
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-08 14:35:47" itemprop="dateCreated datePublished" datetime="2022-04-08T14:35:47+08:00">2022-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-21 19:58:32" itemprop="dateModified" datetime="2022-08-21T19:58:32+08:00">2022-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">Web框架</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
      
        <h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>软件版本：java1.8，maven3.5.0，mysql5.7.25</p>
<ol>
<li><p>安装maven3.5.0</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://how2j.cn/k/maven/maven-download-config/1329.html">Maven系列教材 （二）- 下载与配置Maven (how2j.cn)</a></p>
</blockquote>
<span id="more"></span>
</li>
<li><p>新建项目</p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105029040.png" alt="image-20220819105029040"></p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105105212.png" alt="image-20220819105105212"></p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105304989.png" alt="image-20220819105304989"></p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105336611.png" alt="image-20220819105336611"></p>
</li>
<li><p><code>D:\apache-maven-3.5.0\conf\settings.xml</code>更改成阿里云的下载地址</p>
</li>
<li><p>重新引入一下</p>
<img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819105859291.png" alt="image-20220819105859291" style="zoom:67%;" /></li>
</ol>
<h2 id="第一次启动"><a href="#第一次启动" class="headerlink" title="第一次启动"></a>第一次启动</h2><p>注意Test可能报错类不存在，是因为test的包名错了</p>
<p>改成<code>import org.junit.Test;</code></p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819111323585.png" alt="image-20220819111323585"></p>
<p>什么都没有，因为什么都没写</p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819111525689.png" alt="image-20220819111525689"></p>
<h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><ol>
<li><p><strong>@SpringBootApplication：申明让spring boot自动给程序进行必要的配置</strong></p>
<p>一般用在main方法所在的类上面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuckymoneyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(LuckymoneyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Controller：</strong>处理http请求</p>
</li>
<li><p><strong>@RestController：用于标注控制层组件</strong></p>
<p>一般在实施具体逻辑的类上面，Spring4之后新加的注解，原来返回json需要@ResponseBody配合@Controller</p>
</li>
<li><p><strong>@GetMapping：只支持GET请求访问</strong></p>
<p>一般放到@RestControlle标注的类的方法上面，通过return值，将内容展示出来</p>
<p>例如@GetMapping(“&#x2F;hello”)，就是可以用GET请求访问<a target="_blank" rel="noopener" href="http://localhost:8080/hello">http://localhost:8080/hello</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello SpringBoot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>@Value()，单个配置载入</strong>，用在变量上</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;minMoney&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> BigDecimal minMoney;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**将类连接yml配置，@Component和@ConfigurationProperties()**，放在类上面，参考后文的 多个配置载入</p>
</li>
<li><p><strong>@Autowired</strong> 参考后文的 多个配置载入</p>
</li>
<li><p><strong>@Entity</strong> 表明这是一个实体类，要与数据库做orm映射，默认表的名字就是类名，表中的字段就是类中的属性</p>
</li>
<li><p><strong>@Id</strong> 标注用于声明一个实体类的属性映射为数据库的主键列</p>
</li>
<li><p><strong>@GeneratedValue</strong> 表示自增</p>
</li>
<li><p><strong>@PostMapping(“”)</strong> 类似@GetMapping，支持POST请求，并且可以指定访问路径</p>
</li>
<li><p><strong>@RequestParam(“produce”) String produce</strong> 获取请求参数的值。请求参数，谁创建的红包，发了多少钱</p>
</li>
<li><p><strong>@PathVariable(“id”) Integer id</strong> 获取url中的数据。一般是接受@GetMapping(“&#x2F;luckymoneys&#x2F;{id}”)或者@PutMapping(“&#x2F;luckymoneys&#x2F;{id}”)里面的参数{id}的</p>
</li>
<li><p><strong>@PutMapping</strong> </p>
</li>
<li><p><strong>@Service</strong> 注解用于类上，标记当前类是一个service类，加上该注解会将当前类自动注入到spring容器中，不需要再在applicationContext.xml文件定义bean了</p>
</li>
<li><p><strong>@Transactional</strong> 相当于事务的注解，**@Transactional只能保证java一同给你提交，也就是只是在java层面支持事务，但是不代表数据库本身支持事务，数据库引擎要更换成InnoDB才支持事务**</p>
</li>
</ol>
<h1 id="项目启动方式"><a href="#项目启动方式" class="headerlink" title="项目启动方式"></a>项目启动方式</h1><h2 id="直接通过idea启动"><a href="#直接通过idea启动" class="headerlink" title="直接通过idea启动"></a>直接通过idea启动</h2><h2 id="mvn命令启动"><a href="#mvn命令启动" class="headerlink" title="mvn命令启动"></a>mvn命令启动</h2><p>进入项目包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users&gt;<span class="built_in">cd</span> /d D:\project\springboot_Luckymoney</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn spring-root:<span class="built_in">run</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>如果使用maven命令打包报错：无效的目标发行版</p>
<p>可能是使用的jdk版本和maven中配置的jdk版本不一致</p>
<p>只需要在D:\apache-maven-3.5.0\conf目录下修改setting.xml配置文件，在<code>&lt;profiles&gt;</code>标签中添加以下内容</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;profile&gt;</span>    </span><br><span class="line">    <span class="section">&lt;id&gt;</span><span class="attribute">jdk</span>-<span class="number">1</span>.<span class="number">8</span>&lt;/id&gt;    </span><br><span class="line">    <span class="section">&lt;activation&gt;</span>    </span><br><span class="line">        <span class="section">&lt;activeByDefault&gt;</span><span class="attribute">true</span>&lt;/activeByDefault&gt;    </span><br><span class="line">        <span class="section">&lt;jdk&gt;</span><span class="attribute">1</span>.<span class="number">8</span>&lt;/jdk&gt;    </span><br><span class="line">    <span class="section">&lt;/activation&gt;</span>    </span><br><span class="line">    <span class="section">&lt;properties&gt;</span>    </span><br><span class="line">        <span class="section">&lt;maven.compiler.source&gt;</span><span class="attribute">1</span>.<span class="number">8</span>&lt;/maven.compiler.source&gt;    </span><br><span class="line">        <span class="section">&lt;maven.compiler.target&gt;</span><span class="attribute">1</span>.<span class="number">8</span>&lt;/maven.compiler.target&gt;    </span><br><span class="line">        <span class="section">&lt;maven.compiler.compilerVersion&gt;</span><span class="attribute">1</span>.<span class="number">8</span>&lt;/maven.compiler.compilerVersion&gt;    </span><br><span class="line">    <span class="section">&lt;/properties&gt;</span>    </span><br><span class="line"><span class="section">&lt;/profile&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="mvn打包后启动"><a href="#mvn打包后启动" class="headerlink" title="mvn打包后启动"></a>mvn打包后启动</h2><p>打包：mvn clean package</p>
<p>启动：java -jar target&#x2F;luckymoney-0.0.1-SNAPSHOT.jar</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置端口及path"><a href="#配置端口及path" class="headerlink" title="配置端口及path"></a>配置端口及path</h2><p><strong>方式一：</strong></p>
<p>配置都写在<code>D:\project\springboot_Luckymoney\src\main\resources\application.properties</code>里面</p>
<p>改变端口：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span>.<span class="keyword">port</span>=8081</span><br></pre></td></tr></table></figure>

<p>增加一个路径：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.servlet.context-path</span>=/luckymoney</span><br></pre></td></tr></table></figure>

<p>这样<code>http://localhost:8080/hello</code>就不能访问了，要访问<code>http://localhost:8081/luckymoney/hello</code></p>
<p><strong>方式二：</strong></p>
<p>在<code>application.properties</code>同文件，创建一个<code>application.yml</code>，文件，然后删除<code>application.properties</code>，在<code>application.yml</code>文件里面配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/luckymoney</span></span><br></pre></td></tr></table></figure>

<h2 id="配置红包最小金额"><a href="#配置红包最小金额" class="headerlink" title="配置红包最小金额"></a>配置红包最小金额</h2><p>在<code>application.yml</code>文件里面添加</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">minMoney</span>: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="单个配置载入"><a href="#单个配置载入" class="headerlink" title="单个配置载入"></a>单个配置载入</h3><p>单个配置直接用@Value()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minMoney&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal minMoney;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;minMoney:&quot;</span> + minMoney;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置发红包说明"><a href="#配置发红包说明" class="headerlink" title="配置发红包说明"></a>配置发红包说明</h2><p>在<code>application.yml</code>文件里面添加</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">description:</span> 最少要发一元</span><br></pre></td></tr></table></figure>

<p>配置载入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minMoney&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal minMoney;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;description&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;minMoney:&quot;</span> + minMoney + <span class="string">&quot;，说明:&quot;</span> + description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819140112581.png" alt="image-20220819140112581"></p>
<p>在配置里面使用配置：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">minMoney</span>: <span class="number">2</span></span><br><span class="line"><span class="comment">#在配置里面使用配置</span></span><br><span class="line"><span class="attribute">description</span>: 最少要发<span class="variable">$&#123;minMoney&#125;</span>元</span><br></pre></td></tr></table></figure>

<h2 id="多个配置载入，使用对象配置"><a href="#多个配置载入，使用对象配置" class="headerlink" title="多个配置载入，使用对象配置"></a>多个配置载入，使用对象配置</h2><p>配置很多，并且配置之间有联系，则把配置放到类里面去，通过这个类的对象调用变量</p>
<p>1.更改 .yml 文件，加前缀 limit</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">limit:</span></span><br><span class="line">  <span class="attr">minMoney:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">maxMoney:</span> <span class="number">9999</span></span><br><span class="line">  <span class="comment">#在配置里面使用配置</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">最少要发$&#123;minMoney&#125;元</span></span><br></pre></td></tr></table></figure>

<p>2.然后使用@Component，以及将类连接yml配置@ConfigurationProperties，并且LimitConfig这个类里面的变量名必须和配置变量名一致，例如配置中的maxMoney: 9999就对应LimitConfig的private BigDecimal maxMoney;</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = <span class="string">&quot;limit&quot;</span>)</span>的意思就是连接limit这个前缀的配置</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;limit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LimitConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal minMoney;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal maxMoney;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">getMinMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> minMoney;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMinMoney</span><span class="params">(BigDecimal minMoney)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.minMoney = minMoney;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">getMaxMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> maxMoney;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMaxMoney</span><span class="params">(BigDecimal maxMoney)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxMoney = maxMoney;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.HelloController类，通过@Autowired自动接线，连接LimitConfig，得到LimitConfig对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LimitConfig limitConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;说明:&quot;</span> + limitConfig.getDescription();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分离开发和上线环境"><a href="#分离开发和上线环境" class="headerlink" title="分离开发和上线环境"></a>分离开发和上线环境</h1><p>让测试的时候，最小金额是1分钱，上线以后，最小金额是1元钱</p>
<p>复制application.yml文件，变成开发环境配置application-dev.yml，和上线配置application-prod.yml</p>
<p><strong>application-dev.yml：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/luckymoney</span></span><br><span class="line"></span><br><span class="line"><span class="attr">limit:</span></span><br><span class="line">  <span class="attr">minMoney:</span> <span class="number">0.01</span></span><br><span class="line">  <span class="attr">maxMoney:</span> <span class="number">9999</span></span><br><span class="line">  <span class="comment">#在配置里面使用配置</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">最少要发$&#123;limit.minMoney&#125;元，最多要发$&#123;limit.maxMoney&#125;元</span></span><br></pre></td></tr></table></figure>

<p><strong>application-prod.yml：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/luckymoney</span></span><br><span class="line"></span><br><span class="line"><span class="attr">limit:</span></span><br><span class="line">  <span class="attr">minMoney:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">maxMoney:</span> <span class="number">9999</span></span><br><span class="line">  <span class="comment">#在配置里面使用配置</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">最少要发$&#123;limit.minMoney&#125;元，最多要发$&#123;limit.maxMoney&#125;元</span></span><br></pre></td></tr></table></figure>

<p><strong>application.yml：</strong></p>
<p>表示现在用的是dev，开发环境</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>测试结果：</p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819150559273.png" alt="image-20220819150559273"></p>
<p><strong>不通过idea应用不同配置的方法：</strong></p>
<p>打包：mvn clean package</p>
<p>启动：java -jar target&#x2F;luckymoney-0.0.1-SNAPSHOT.jar</p>
<p>启动prod配置：java -jar -Dspring.profiles.active&#x3D;prod target&#x2F;luckymoney-0.0.1-SNAPSHOT.jar</p>
<h1 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h1><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155417931.png" alt="image-20220819155417931" style="zoom:50%;" />

<img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155424289.png" alt="image-20220819155424289" style="zoom:50%;" />

<h2 id="明确设计目标"><a href="#明确设计目标" class="headerlink" title="明确设计目标"></a>明确设计目标</h2><p>resful API设计</p>
<img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155557638.png" alt="image-20220819155557638" style="zoom:50%;" />

<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p>在pom.xml文件中加入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这时，完整的依赖文件是</p>
<p><strong>pom.xml：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>luckymoney<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>luckymoney<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><p>application-dev.yml：</p>
<p><strong>注意：在<code>url</code>结尾一定要加<code>&amp;serverTimezone=Asia/Shanghai</code>，不然Spring Boot连接数据库的时候会报错</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/luckymoney</span></span><br><span class="line"></span><br><span class="line"><span class="attr">limit:</span></span><br><span class="line">  <span class="attr">minMoney:</span> <span class="number">0.01</span></span><br><span class="line">  <span class="attr">maxMoney:</span> <span class="number">9999</span></span><br><span class="line">  <span class="comment">#在配置里面使用配置</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">最少要发$&#123;limit.minMoney&#125;元，最多要发$&#123;limit.maxMoney&#125;元</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/luckymoney?characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#     create表示如果表存在，则删除这个表；update表示在原有表上更新</span></span><br><span class="line"><span class="comment">#     ddl-auto: create</span></span><br><span class="line"><span class="comment">#   是否在控制台展示sql语句</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="建库"><a href="#建库" class="headerlink" title="建库"></a>建库</h2><p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819161137300.png" alt="image-20220819161137300"></p>
<h2 id="建表ORM映射"><a href="#建表ORM映射" class="headerlink" title="建表ORM映射"></a>建表ORM映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表明这是一个实体类，要与数据库做orm映射，默认表的名字就是类名，表中的字段就是类中的属性</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Luckymoney</span> &#123;</span><br><span class="line">    <span class="comment">// 标注用于声明一个实体类的属性映射为数据库的主键列</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="comment">// 表示自增</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal money;</span><br><span class="line">    <span class="comment">// 发送方</span></span><br><span class="line">    <span class="keyword">private</span> String produce;</span><br><span class="line">    <span class="comment">// 接收方</span></span><br><span class="line">    <span class="keyword">private</span> String consumer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Luckymoney</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">getMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMoney</span><span class="params">(BigDecimal money)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProduce</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> produce;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProduce</span><span class="params">(String produce)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.produce = produce;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConsumer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> consumer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConsumer</span><span class="params">(String consumer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.consumer = consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询数据库的接口"><a href="#查询数据库的接口" class="headerlink" title="查询数据库的接口"></a>查询数据库的接口</h2><p>LuckmoneyRepository继承JpaRepository接口，主要是用来得到JpaRepository的方法，例如findAll()等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JpaRepository&lt;Luckymoney, Integer&gt; 第一个参数代表数据库的实体类，第二个参数是ID的类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LuckmoneyRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Luckymoney, Integer&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制红包数据库的类"><a href="#控制红包数据库的类" class="headerlink" title="控制红包数据库的类"></a>控制红包数据库的类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuckymoneyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LuckmoneyRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取红包列表</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/luckymoneys&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Luckymoney&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// findAll()查询所有Luckymoney列表</span></span><br><span class="line">        <span class="keyword">return</span> repository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用postman测试：<a target="_blank" rel="noopener" href="http://localhost:8081/luckymoney/luckymoneys">http://localhost:8081/luckymoney/luckymoneys</a></p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819172623634.png" alt="image-20220819172623634"></p>
<h1 id="实现其他接口"><a href="#实现其他接口" class="headerlink" title="实现其他接口"></a>实现其他接口</h1><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220819155557638.png" alt="image-20220819155557638" style="zoom:50%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuckymoneyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LuckmoneyRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取红包列表</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/luckymoneys&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Luckymoney&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// findAll()查询所有Luckymoney列表</span></span><br><span class="line">        <span class="keyword">return</span> repository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建红包(发红包)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/luckymoney&quot;)</span></span><br><span class="line">    <span class="comment">// @RequestParam(&quot;producer&quot;) String producer请求参数，谁创建的红包，发了多少钱</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">create</span><span class="params">(<span class="meta">@RequestParam(&quot;produce&quot;)</span> String produce,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span> &#123;</span><br><span class="line">        <span class="type">Luckymoney</span> <span class="variable">luckymoney</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Luckymoney</span>();</span><br><span class="line">        luckymoney.setProduce(produce);</span><br><span class="line">        luckymoney.setMoney(money);</span><br><span class="line">        <span class="keyword">return</span> repository.save(luckymoney);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过ID查询红包</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/luckymoneys/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// orElse(null) 如果查不到，就返回null</span></span><br><span class="line">        <span class="keyword">return</span> repository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新红包(领红包)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/luckymoneys/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// 更新的是comsumer，谁领了红包，传入id是因为id是主键，要通过主键定位</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestParam(&quot;consumer&quot;)</span> String consumer)</span> &#123;</span><br><span class="line">        <span class="comment">// 先把要更新的数据查询出来</span></span><br><span class="line">        Optional&lt;Luckymoney&gt; optional= repository.findById(id);</span><br><span class="line">        <span class="comment">// 如果有内容，再执行更新的操作</span></span><br><span class="line">        <span class="keyword">if</span> (optional.isPresent()) &#123;</span><br><span class="line">            <span class="type">Luckymoney</span> <span class="variable">luckymoney</span> <span class="operator">=</span> optional.get();</span><br><span class="line">            <span class="comment">// 查出来以后再更新</span></span><br><span class="line">            luckymoney.setConsumer(consumer);</span><br><span class="line">            <span class="keyword">return</span> repository.save(luckymoney);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>数据库事务，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行</p>
<p><strong>@Transactional只能保证java一同给你提交，也就是只是在java层面支持事务，但是不代表数据库本身支持事务，数据库引擎要更换成InnoDB才支持事务</strong></p>
<p><strong>可以用于 扣库存 &gt; 创建订单 的同时性</strong></p>
<p>修改数据库的引擎，事务即可生效：</p>
<p><img src="https://typora1321.oss-cn-beijing.aliyuncs.com/image-20220821184121229.png" alt="image-20220821184121229"></p>
<h2 id="LuckymoneyController"><a href="#LuckymoneyController" class="headerlink" title="LuckymoneyController"></a>LuckymoneyController</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuckymoneyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LuckmoneyRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LuckymoneyService service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取红包列表</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/luckymoneys&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Luckymoney&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// findAll()查询所有Luckymoney列表</span></span><br><span class="line">        <span class="keyword">return</span> repository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建红包(发红包)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/luckymoney&quot;)</span></span><br><span class="line">    <span class="comment">// @RequestParam(&quot;producer&quot;) String producer请求参数，谁创建的红包，发了多少钱</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">create</span><span class="params">(<span class="meta">@RequestParam(&quot;produce&quot;)</span> String produce,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span> &#123;</span><br><span class="line">        <span class="type">Luckymoney</span> <span class="variable">luckymoney</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Luckymoney</span>();</span><br><span class="line">        luckymoney.setProduce(produce);</span><br><span class="line">        luckymoney.setMoney(money);</span><br><span class="line">        <span class="keyword">return</span> repository.save(luckymoney);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过ID查询红包</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/luckymoneys/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// orElse(null) 如果查不到，就返回null</span></span><br><span class="line">        <span class="keyword">return</span> repository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新红包(领红包)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/luckymoneys/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// 更新的是comsumer，谁领了红包，传入id是因为id是主键，要通过主键定位</span></span><br><span class="line">    <span class="keyword">public</span> Luckymoney <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestParam(&quot;consumer&quot;)</span> String consumer)</span> &#123;</span><br><span class="line">        <span class="comment">// 先把要更新的数据查询出来</span></span><br><span class="line">        Optional&lt;Luckymoney&gt; optional= repository.findById(id);</span><br><span class="line">        <span class="comment">// 如果有内容，再执行更新的操作</span></span><br><span class="line">        <span class="keyword">if</span> (optional.isPresent()) &#123;</span><br><span class="line">            <span class="type">Luckymoney</span> <span class="variable">luckymoney</span> <span class="operator">=</span> optional.get();</span><br><span class="line">            <span class="comment">// 查出来以后再更新</span></span><br><span class="line">            luckymoney.setConsumer(consumer);</span><br><span class="line">            <span class="keyword">return</span> repository.save(luckymoney);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/luckymoney/two&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        service.createTwo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LuckymoneyService事务"><a href="#LuckymoneyService事务" class="headerlink" title="LuckymoneyService事务"></a>LuckymoneyService事务</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.luckymoney;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// @Service注解用于类上，标记当前类是一个service类，加上该注解会将当前类自动注入到spring容器中，不需要再在applicationContext.xml文件定义bean了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuckymoneyService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LuckmoneyRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 事务 指数据库事务 数据库引擎要更换成InnoDB才支持事务</span></span><br><span class="line">    <span class="comment">// 可以用于 扣库存 &gt; 创建订单 的同时性</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">// 事务注解</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Luckymoney</span> <span class="variable">luckymoney1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Luckymoney</span>();</span><br><span class="line">        luckymoney1.setProduce(<span class="string">&quot;熊大&quot;</span>);</span><br><span class="line">        luckymoney1.setMoney(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">520</span>));</span><br><span class="line">        repository.save(luckymoney1);</span><br><span class="line"></span><br><span class="line">        <span class="type">Luckymoney</span> <span class="variable">luckymoney2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Luckymoney</span>();</span><br><span class="line">        luckymoney2.setProduce(<span class="string">&quot;熊大&quot;</span>);</span><br><span class="line">        luckymoney2.setMoney(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">1314</span>));</span><br><span class="line">        repository.save(luckymoney2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>郭霖
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://guolinac.github.io/2022/04/08/Spring-Boot%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="Spring Boot红包小程序">https://guolinac.github.io/2022/04/08/Spring-Boot小程序/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

  
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring-Boot/" rel="tag"><i class="fa fa-tag"></i> Spring Boot</a>
              <a href="/tags/%E7%BA%A2%E5%8C%85%E7%A8%8B%E5%BA%8F/" rel="tag"><i class="fa fa-tag"></i> 红包程序</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/07/%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%93%E5%AD%98/" rel="prev" title="手写实现高性能缓存">
      <i class="fa fa-chevron-left"></i> 手写实现高性能缓存
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/23/Java/" rel="next" title="Java">
      Java <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8"><span class="nav-text">第一次启动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3"><span class="nav-text">注解</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">项目启动方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87idea%E5%90%AF%E5%8A%A8"><span class="nav-text">直接通过idea启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mvn%E5%91%BD%E4%BB%A4%E5%90%AF%E5%8A%A8"><span class="nav-text">mvn命令启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mvn%E6%89%93%E5%8C%85%E5%90%8E%E5%90%AF%E5%8A%A8"><span class="nav-text">mvn打包后启动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E5%8F%8Apath"><span class="nav-text">配置端口及path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BA%A2%E5%8C%85%E6%9C%80%E5%B0%8F%E9%87%91%E9%A2%9D"><span class="nav-text">配置红包最小金额</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%B8%AA%E9%85%8D%E7%BD%AE%E8%BD%BD%E5%85%A5"><span class="nav-text">单个配置载入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%91%E7%BA%A2%E5%8C%85%E8%AF%B4%E6%98%8E"><span class="nav-text">配置发红包说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E8%BD%BD%E5%85%A5%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE"><span class="nav-text">多个配置载入，使用对象配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91%E5%92%8C%E4%B8%8A%E7%BA%BF%E7%8E%AF%E5%A2%83"><span class="nav-text">分离开发和上线环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">连接数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%8E%E7%A1%AE%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87"><span class="nav-text">明确设计目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-text">引入依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">配置数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E5%BA%93"><span class="nav-text">建库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E8%A1%A8ORM%E6%98%A0%E5%B0%84"><span class="nav-text">建表ORM映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-text">查询数据库的接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E7%BA%A2%E5%8C%85%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%B1%BB"><span class="nav-text">控制红包数据库的类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%85%B6%E4%BB%96%E6%8E%A5%E5%8F%A3"><span class="nav-text">实现其他接口</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LuckymoneyController"><span class="nav-text">LuckymoneyController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LuckymoneyService%E4%BA%8B%E5%8A%A1"><span class="nav-text">LuckymoneyService事务</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="郭霖"
      src="/images/haon1.jpg">
  <p class="site-author-name" itemprop="name">郭霖</p>
  <div class="site-description" itemprop="description">编程使我快乐</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/guolinac" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;guolinac" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>





    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fab fa-google"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭霖</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">482k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">7:19</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
